let cdnRes=['https://cdnx-beta.hswenfa.com'];
let htmlVersion,replaceCdn,self=this,isPwa=!0,checkHash="dc7e1a2f4d8e840803fc4b08aab71850",version="4.0.8.22",swName=isPwa?"[sw_pwa]":"[sw_h5]",openName=isPwa?"pwa":"m",gamePath="/h5V01/m/",idx=self.location.pathname.lastIndexOf("/"),domainPath=self.location.pathname.substring(0,idx+1),indexHtml=self.location.origin+domainPath+"index.html";if(console.warn(swName+" init htmlVersion",htmlVersion,version),console.warn(swName+" init domainPath",domainPath,version),isPwa){const e=async()=>{console.warn(swName+" checkCdn!",version);let e=0,t=!1;const n=cdnRes.length;return new Promise(((a,s)=>{cdnRes.map((async i=>{const o=i+gamePath+"config.json?v="+Math.floor(1e4*Math.random());try{const e=await fetch(o);if(e&&e.ok&&!t){if(await e.json())return console.warn(swName+" set cdn",i,version),replaceCdn=i,t=!0,void a(i)}}catch(e){console.warn(swName+" get cdn fail",i,e.toString(),version)}++e==n&&s("all fail")}))}))},t=async()=>{console.warn(swName+" startCheck",version),bCheckingCdn=!0;try{await e(),bCheckingCdn=!1,console.warn(swName+" checkCdn end",version)}catch(e){console.error(swName+" checkCdn fail",e.toString(),version),setTimeout(t,3e3)}};t()}function checkUrl(e){return e=new URL(e).pathname.replace(domainPath,""),cacheList.includes(e)}async function putInCache(e,t){let n=e.url;if(200==t.status){let a=t.clone();(await caches.open(openName)).put(e,a),console.warn(swName+" putInCache success",n,version)}else console.warn(swName+" putInCache no ",n,t.status,version)}async function handleRangeFile(e,t){const n=await t.arrayBuffer(),a=/^bytes\=(\d+)\-(\d+)?$/g.exec(e.headers.get("range"));if(a){const e=Number(a[1]),t=Number(a[2])||n.byteLength-1;return new Response(n.slice(e,t+1),{status:206,statusText:"Partial Content",headers:[["Content-Range",`bytes ${e}-${t}/${n.byteLength}`]]})}return new Response(null,{status:416,statusText:"Range Not Satisfiable",headers:[["Content-Range",`*/${n.byteLength}`]]})}async function fetchFile(e,t){let n,a=e.origin+e.pathname,s=checkUrl(a);try{if(s&&(n=await caches.match(a==indexHtml?a:t)),n&&a!=indexHtml){if(t.headers.get("range"))return handleRangeFile(t,n)}else{let i,o={cache:a==indexHtml&&htmlVersion!=version?"reload":"no-cache",mode:"cors",credentials:"omit",referrerPolicy:"",headers:new Headers};if(isPwa&&replaceCdn&&a!=indexHtml){let t=a.replace(e.origin,replaceCdn);t=t.replace(domainPath,gamePath),i=new Request(t,o)}else i="navigate"==t.mode?new Request(a,o):new Request(t,o);const c=()=>new Promise(((e,o)=>{let c=!1;n&&setTimeout((()=>{c||e(n)}),3e3),fetch(i).then((n=>{n.ok?(c=!0,s&&putInCache(a==indexHtml?new Request(a):t,n),e(n)):o("status="+n.status)})).catch((e=>{o("error="+e.toString())}))}));n=await c()}}catch(e){console.error(swName+" fetch error",a,e.toString(),version)}return n||(n=new Response("Network error happened",{status:404,headers:{"Content-Type":"text/plain"}})),n}async function checkSW(e){try{let t=await fetch(self.location.href,{cache:"reload"});if(e&&t&&t.ok){let e=(await t.clone().text()).match(/checkHash\s*=\s*"([^"]*)"/);if(console.warn(swName+"sw_update  checkHash",e[1],version),e&&e[1]!=checkHash)callClients("sw_update","sw version diff!");else if(htmlVersion&&htmlVersion!=version){let e=await fetch(indexHtml,{cache:"reload"});if(e&&e.ok){let t=(await e.clone().text()).match(/htmlInfo.version\s*=\s*"([^"]*)"/);console.warn(swName+"sw_update  checkHtml",t[1],version),t&&t[1]==version&&(await putInCache(new Request(indexHtml),e),callClients("sw_reload","html:"+htmlVersion+",sw:"+version))}}}}catch(e){console.error(swName+"  checkSW fail",e.toString(),version)}}function callClients(e,t){self.clients.matchAll().then((n=>{console.warn(swName+" callClients ",e,t,n,version),n.forEach((n=>{n.postMessage({type:e,value:t})}))}))}self.addEventListener("install",(function(e){console.warn(swName+" install!",version);e.waitUntil((console.warn(swName+" install skipWaiting!",version),void self.skipWaiting()))})),self.addEventListener("activate",(function(e){async function t(){const e=await caches.open(openName),t=await e.keys();await Promise.all(t.map((function(t){let n=t.url;if(0==checkUrl(n))return console.warn(swName+" deleteCurCache delete",n,version),e.delete(t)}))),console.warn(swName+" deleteCurCache complete",version)}console.warn(swName+" activate",version),self.clients.claim(),e.waitUntil((async()=>{await Promise.all([t()]).then((function(){console.warn(swName+" activate complete",version)}))})())})),self.addEventListener("message",(e=>{console.warn(swName+" message ",e.data,version),e.data&&("VERSION"===e.data.type?(htmlVersion=e.data.value,htmlVersion!=version&&checkSW(!0)):"UPDATE"===e.data.type&&checkSW(e.data.value||htmlVersion!=version))})),self.addEventListener("fetch",(function(e){let t=e.request,n=t.url;if("GET"!==t.method)return!1;if(n.match(/\?/)&&(n=n.split("?")[0]),n.match(/pwa_sw.js|pwa_dir|pwa.html|index_a.html/))return!1;let a=new URL(n);return!!a.pathname.match(domainPath)&&(!(t.referrer.match(/.html/)&&!t.referrer.match(/index.html/))&&void e.respondWith(fetchFile(a,t)))}));let cacheList=[];